<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Admin</title>
  <link rel="stylesheet" href="./css/styles.css">
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h2>Admin</h2>
    <button onclick="showModule('comunicados')" data-icon="">Comunicados</button>
    <button onclick="showModule('documentos')" data-icon="">Documentos</button>
    <button onclick="showModule('anexos')" data-icon="">Anexos</button>
  </div>

  <!-- Main content -->
  <div class="main">
    <header>
      <h1>Panel de Administraci贸n</h1>
      <button onclick="logout()">Cerrar Sesi贸n</button>
    </header>

    <!-- Contenedores para cada m贸dulo -->
    <div id="comunicadosModule" class="module" style="display:none;">
      <h2>Comunicados</h2>
      <form onsubmit="addItem(event, 'comunicados')">
        <input type="text" name="nombre" placeholder="Nombre" required>
        <input type="text" name="tipoDocumento" placeholder="Tipo" required>
        <input type="text" name="link" placeholder="Link" required>
        <button type="submit">Agregar</button>
      </form>
      <table id="comunicadosTable">
        <thead>
          <tr><th>ID</th><th>Nombre</th><th>Tipo</th><th>Link</th><th>QR</th><th>Usuario</th><th>Acciones</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="documentosModule" class="module" style="display:none;">
      <h2>Documentos</h2>
      <form onsubmit="addItem(event, 'documentos')">
        <input type="text" name="nombre" placeholder="Nombre" required>
        <input type="text" name="tipoDocumento" placeholder="Tipo" required>
        <input type="text" name="link" placeholder="Link" required>
        <button type="submit">Agregar</button>
      </form>
      <table id="documentosTable">
        <thead>
          <tr><th>ID</th><th>Nombre</th><th>Tipo</th><th>Link</th><th>QR</th><th>Usuario</th><th>Acciones</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="anexosModule" class="module" style="display:none;">
      <h2>Anexos</h2>
      <form onsubmit="addItem(event, 'anexos')">
        <input type="text" name="nombre" placeholder="Nombre" required>
        <input type="text" name="tipoDocumento" placeholder="Tipo" required>
        <input type="text" name="link" placeholder="Link" required>
        <button type="submit">Agregar</button>
      </form>
      <table id="anexosTable">
        <thead>
          <tr><th>ID</th><th>Nombre</th><th>Tipo</th><th>Link</th><th>QR</th><th>Usuario</th><th>Acciones</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

  </div>

  <script src="./js/app.js"></script>
  <script>
    // Mostrar m贸dulo
    function showModule(tipo) {
      document.querySelectorAll('.module').forEach(m => m.style.display = 'none');
      const mod = document.getElementById(tipo + 'Module');
      if(mod) mod.style.display = 'block';
      loadModuleData(tipo);
    }

    // Cargar datos
    async function loadModuleData(tipo) {
      const items = await getItems(tipo);
      const tableBody = document.getElementById(tipo + 'Table').querySelector('tbody');
      tableBody.innerHTML = '';
      items.forEach(item => {
        const idKey = Object.keys(item).find(k => k.toLowerCase().includes("id"));
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item[idKey]}</td>
          <td>${item.Nombre}</td>
          <td>${item.Tipo}</td>
          <td><a href="${item.Link}" target="_blank">Ver</a></td>
          <td><a href="${item["QR Online"]}" target="_blank">QR</a></td>
          <td>${item["Usuario Crea"]}</td>
          <td>
            <button onclick="editItem('${tipo}', '${item[idKey]}')">Editar</button>
            <button onclick="deleteItem('${tipo}', '${item[idKey]}')">Eliminar</button>
          </td>
        `;
        tableBody.appendChild(tr);
      });
    }

    // Agregar registro
    async function addItem(event, tipo){
      event.preventDefault();
      const form = event.target;
      const nombre = form.nombre.value;
      const tipoDocumento = form.tipoDocumento.value;
      const link = form.link.value;

      try{
        await createItem(tipo, nombre, tipoDocumento, link);
        form.reset();
        loadModuleData(tipo);
      }catch(e){
        alert("Error al agregar item: " + e.message);
      }
    }
  </script>
</body>
</html>
